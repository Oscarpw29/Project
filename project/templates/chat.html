{% extends 'base.html' %}

{% block content %}
<div class="chat-container">
    <div class="chat-header">
        <h1>Chat with {{ recipient.username }}</h1>
        </div>
    <div id="messages" class="chat-messages">
        {% if messages %}
            {% for message in messages %}
                <div class="message-container {% if message.sender == user %}sent{% else %}received{% endif %}">
                    <div class="message-bubble">
                        <p id = "msg-{{ message.id }}">
                            {% if message.chat_type == 'secret' %}
                                {{ message.message | safe }}
                            {% else %}
                                {{ message.message }}
                            {% endif %}
                        </p>
                        <small class="message-timestamp">{{ message.timestamp.strftime('%Y-%m-%d %H:%M') }}</small>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p class="no-messages">No messages yet. Start the conversation!</p>
        {% endif %}
    </div>
    <div class="chat-input-area">
        <form id="send-message-form">
            <input type="text" id="message-input" placeholder="Type your message...">
            <button type="submit">Send</button>
        </form>
    </div>
</div>
<script>
    const chatId = "{{ chat_id }}";
    const currentChatType = "{{ chat_type }}";
    const currentUserId = "{{ user.id }}";
    const currentUsername = "{{ user.username }}";
    const recipientId = "{{ recipient.id }}";
    const recipientUsername = "{{ recipient.username }}";
</script>
<script src="/dist/chat.js"></script>
<style>
    .chat-container {
        max-width: 800px;
        margin: 20px auto;
        border: 1px solid #ccc;
        border-radius: 5px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        height: 600px; /* Adjust as needed */
    }

    .chat-header {
        background-color: #f8f8f8;
        padding: 15px;
        border-bottom: 1px solid #eee;
        text-align: center;
    }

    .chat-messages {
        flex-grow: 1;
        padding: 15px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
    }

    .message-container {
        margin-bottom: 10px;
        display: flex;
        clear: both; /* Prevent floating issues */
    }

    .sent {
        justify-content: flex-end;
    }

    .received {
        justify-content: flex-start;
    }

    .message-bubble {
        background-color: #e0f7fa; /* Light blue for received */
        color: #333;
        padding: 10px 15px;
        border-radius: 10px;
        max-width: 70%;
        word-wrap: break-word;
    }

    .sent .message-bubble {
        background-color: #dcf8c6; /* Light green for sent */
        color: #333;
    }

    .message-timestamp {
        display: block;
        font-size: 0.8em;
        color: #777;
        margin-top: 5px;
    }

    .chat-input-area {
        padding: 15px;
        border-top: 1px solid #eee;
    }

    #send-message-form {
        display: flex;
    }

    #message-input {
        flex-grow: 1;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px 0 0 5px;
        outline: none;
    }

    #send-message-form button {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 0 5px 5px 0;
        cursor: pointer;
    }

    #send-message-form button:hover {
        background-color: #0056b3;
    }

    .no-messages {
        text-align: center;
        color: #777;
        padding: 20px;
    }
</style>
{% endblock %}